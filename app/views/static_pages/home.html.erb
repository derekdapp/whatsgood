<input type="hidden" name="page-number" value="1" id="page-number">
<input type="hidden" name="can-load-more" value="true" id="can-load-more">
<div class='row'>
  <div class="events-list col-xs-12 col-md-7 col-lg-8">
    <%= render partial: 'events/events', :locals => {:events => @events} %>
  </div>
  <div class='allmaps col-md-5 col-lg-4 visible-md-block visible-lg-block'>
    <div id="multi_marks"></div>

    <div class="btn-group" id="cat-boxes" data-toggle="buttons">
      <% current_user.categories.each do |cat| %>
      <label class="btn btn-primary active">
        <input type="checkbox" value="<%= cat.name %>"checked> <%= cat.name %>
      </label>
      <% end %>
    </div>
    <button type="button" class="btn btn-success" id="cat-apply">Apply</button>

    <div class="stats"><h1>whatsgood</h1>
      <h1 id="loading-status"></h1>
      <ul>
        <li>Total items: <%= @result['total_items'] %></li>
        <li>Page Size: <%= @result['page_size'] %></li>
        <li>Pages: <%= @result['page_count'] %></li>
        <li>Page no: <%= @result['page_number'] %></li>
        <li>Search time: <%= @result['search_time'].round(2) %> seconds</li>
      </ul>  

    </div>
  </div>
</div>



<script type="text/javascript">
  var handler = Gmaps.build('Google');
  handler.buildMap({
      internal: {id: 'multi_marks'},
      provider: {
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        styles:  mapStyle
      }
    },
    function(){
      if(navigator.geolocation)
      navigator.geolocation.getCurrentPosition(displayOnMap);
  });


  var handler = Gmaps.build('Google');
  handler.buildMap({ internal: {id: 'multi_marks'} }, function(){
  if(navigator.geolocation)
    navigator.geolocation.getCurrentPosition(displayOnMap);
  });
  function displayOnMap(position){
  var marker = handler.addMarker({
    lat: position.coords.latitude,
    lng: position.coords.longitude,
    infowindow: "<h6 style=padding: 1.25em;>You're Here, Zoom Out!</h6>"
  });
  handler.map.centerOn(marker);
  handler.getMap();
  };

  var handler = Gmaps.build('Google');
  handler.buildMap({ internal: {id: 'multi_marks'}}, function(){
    var markers = handler.addMarkers(
      <%=raw @hash.to_json%>
    );
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
  });

  var mapStyle = [{"featureType":"administrative","stylers":[{"visibility":"off"}]},{"featureType":"poi","stylers":[{"visibility":"simplified"}]},{"featureType":"road","elementType":"labels","stylers":[{"visibility":"simplified"}]},{"featureType":"water","stylers":[{"visibility":"simplified"}]},{"featureType":"transit","stylers":[{"visibility":"simplified"}]},{"featureType":"landscape","stylers":[{"visibility":"simplified"}]},{"featureType":"road.highway","stylers":[{"visibility":"off"}]},{"featureType":"road.local","stylers":[{"visibility":"on"}]},{"featureType":"road.highway","elementType":"geometry","stylers":[{"visibility":"on"}]},{"featureType":"water","stylers":[{"color":"#84afa3"},{"lightness":52}]},{"stylers":[{"saturation":-17},{"gamma":0.36}]},{"featureType":"transit.line","elementType":"geometry","stylers":[{"color":"#3f518c"}]}]
  
// UNCOMMENT  the other mapStyle 
// For a more pale version
// the one above is a "retro version"
  // var mapStyle = [
  //   {'featureType':'water','stylers':[{'visibility':'on'},{'color':'#acbcc9'}]},{'featureType':'landscape','stylers':[{'color':'#f2e5d4'}]},{'featureType':'road.highway','elementType':'geometry','stylers':[{'color':'#c5c6c6'}]},{'featureType':'road.arterial','elementType':'geometry','stylers':[{'color':'#e4d7c6'}]},{'featureType':'road.local','elementType':'geometry','stylers':[{'color':'#fbfaf7'}]},{'featureType':'poi.park','elementType':'geometry','stylers':[{'color':'#c5dac6'}]},{'featureType':'administrative','stylers':[{'visibility':'on'},{'lightness':33}]},{'featureType':'road'},{'featureType':'poi.park','elementType':'labels','stylers':[{'visibility':'on'},{'lightness':20}]},{},{'featureType':'road','stylers':[{'lightness':20}]}
  // ];

  var handler = Gmaps.build('Google');
  handler.buildMap({
      internal: {id: 'multi_marks'},
      provider: {
        styles:    mapStyle
      }
    },
    function(){
    var markers = handler.addMarkers(
      <%=raw @hash.to_json%>
    );
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
  });
</script>
